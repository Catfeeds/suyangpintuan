<?php #后台公共函数库/** * 获得所有模块的名称以及链接地址 * @access      public * @param       string      $directory      插件存放的目录 * @return      array */function read_modules($directory = '.'){    global $_LANG;    $dir         = @opendir($directory);    $set_modules = true;    $modules     = array();    while (false !== ($file = @readdir($dir)))    {        if (preg_match("/^.*?\.php$/", $file))        {            include_once($directory. '/' .$file);        }    }    @closedir($dir);    unset($set_modules);    foreach ($modules AS $key => $value)    {        ksort($modules[$key]);    }    ksort($modules);    return $modules;}/*头像*/function photo($source){    global $lowxp;    $size = 80;    $nopic = '/common/photo.gif';    if(empty($source)) return $nopic;    $img = substr($source,0,strpos($source,'.jpg'));    $img = $img.'_'.$size.'.jpg';    if($lowxp->common['cloudsave']==1){        if (strpos($img, 'http://') === false && strpos($img, 'https://') === false) {            $img = $lowxp->common['cloudurl'].$img;        }        if (strpos($source, 'http://') === false && strpos($source, 'https://') === false) {            $source = $lowxp->common['cloudurl'].$source;        }    }    return is_file(RootDir.'web'.$img) ? $img : $source;}function linkage($id=1,$field="areaid", $hideTop=1){    global $lowxp;    $id = empty($id)?1:$id;    $lowxp->load->model('linkage');    $parseStr = '<div id="select_linkage">';    $parseStr .= $lowxp->linkage->select_linkage($id,$hideTop,$field);    $parseStr .= '</div><script type="text/javascript" src="/admin/js/manage/linkage.js"></script>';    return $parseStr;    }function showlinkage($id=1,$field="areaid", $hideTop=1){    global $lowxp;    $id = empty($id)?1:$id;    $lowxp->load->model('linkage');    $parseStr = '<div id="select_linkage">';    $parseStr .= $lowxp->linkage->select_showlinkage($id,$hideTop,$field);    $parseStr .= '</div><script type="text/javascript" src="/admin/js/manage/linkage.js"></script>';    return $parseStr;}/** * 商品分类，品牌，同城分类联动 * @param  number $id        选择id * @param  string $field     变量名 * @param  string $table     表名 * @return string */function select_cat($id=0,$field="cid", $table="goods_cat",$zone=0){    global $lowxp;    $lowxp->load->model('linkage');    $parseStr = '<div id="select_'.$table.'">';    $parseStr .= $lowxp->linkage->select_cat($id,$field,$table,$zone);    $parseStr .= '</div><script type="text/javascript" src="/admin/js/manage/select_cat.js"></script>';    return $parseStr;}/** * 格式化字节大小 * @param  number $size      字节数 * @param  string $delimiter 数字和单位分隔符 * @return string            格式化后的带单位的大小 */function format_bytes($size, $delimiter = '') {    $units = array('B', 'KB', 'MB', 'GB', 'TB', 'PB');    for ($i = 0; $size >= 1024 && $i < 5; $i++) $size /= 1024;    return round($size, 2) . $delimiter . $units[$i];}