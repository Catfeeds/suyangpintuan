<?php/** * ZZCMS 活动分类 */class topic_type extends Lowxp {	function __construct() {		#按钮		$this->btnMenu = array(			0 => array('url' => '#!topic_type/index', 'name' => '活动类型'),			1 => array('url' => '#!topic_type/edit?com=xshow|添加活动类型', 'name' => '添加活动类型'),		);		parent::__construct();		$this->load->model('topic_type');	}	function index($page = 1) {		#分页		$this->load->model('page');		$_GET['page'] = intval($page);		$this->page->set_vars(array('per' => (int) $this->common['page_listrows']));		#数据集		$sql          = "SELECT * FROM ###_topic_type WHERE 1 ORDER BY id";		$data['list'] = $this->page->hashQuery($sql)->result_array();		$this->smarty->assign('data', $data);		$this->smarty->display('manage/topic_type/list.html');	}	//创建/更新	function edit() {		//提交		if (isset($_POST['Submit'])) {			$res = $this->topic_type->save();			if (isset($res['code']) && $res['code'] == 0) {				$this->tip($res['message'], array('inIframe' => true));				$this->exeJs("parent.com.xhide();parent.main.refresh()");			} else {				$this->tip($res['message'], array('inIframe' => true, 'type' => 1));			}			exit;		}		$id  = (int) $_GET['id'];		$row = array();		//编辑		if ($id) {			$row = $this->db->get("SELECT * FROM ###_topic_type WHERE id=" . $id);			$this->smarty->assign('id', $id);		}		if (!$id) {			$this->smarty->assign('btnNo', 1);		}		        $row['thumb'] = isset($row['thumb']) ? $row['thumb'] : '';        $row['html_thumb'] = $this->form->files('thumb', $row['thumb']);		$this->smarty->assign('row', $row);		$this->smarty->display('manage/topic_type/edit.html');	}	//删除	function del() {		$id = (int) $_POST['id'];		if (!$id) {			die;		}		admin_log('删除活动：' . $this->db->getstr("SELECT name FROM ###_topic_type WHERE id=" . $id));		$this->db->delete('###_topic_type', array('id' => $id));		$this->tip('删除成功');	}}