<?php/** * 首页推广 * 这不是一个自由软件！您只能在不用于商业目的的前提下对程序代码进行修改和 * 使用；不允许对程序代码以任何形式任何目的的再发布。 */class spread extends Lowxp {	function __construct() {        $this->btnMenu = array(            0 => array('url' => '#!spread/index', 'name' => '首页推广'),            1 => array('url' => '#!spread/edit', 'name' => '添加内容'),        );        parent::__construct();        $this->typeid = array(            1=>"/admin/images/spread/1.jpg",            2=>"/admin/images/spread/2.jpg",            3=>"/admin/images/spread/3.jpg",            4=>"/admin/images/spread/4.jpg",            5=>"/admin/images/spread/5.jpg"        );	}    //首页推广列表	function index() {	    $list = $this->db->select("select * from ###_spread order by id asc");	    foreach($list as $k=>$v){            $list[$k]['typename'] = $this->typeid[$v['typeid']];        }		$this->smarty->assign('list', $list);		$this->smarty->display('manage/spread/list.html');	}	//更新	function edit() {		//提交		if (isset($_POST['Submit'])) {			$post = $_POST['post'];            if($post['good_id_selected']){                $post['gid'] = join(',',$post['good_id_selected']);            }else{                $post['gid'] = "";            }            unset($post['good_id_selected']);            if (is_array($post['thumb'])) {                $_arrData = array();                foreach ($post['thumb']['path'] as $k => $v) {                    $_arrData[$k]['path'] = $v;                    $_arrData[$k]['title'] = $post['thumb']['title'][$k];                    $_arrData[$k]['iosurl'] = $post['thumb']['iosurl'][$k];                    $_arrData[$k]['anurl'] = $post['thumb']['anurl'][$k];                }                $post['thumb'] = json_encode($_arrData);            }            if($post['id']>0){                $res = $this->db->update("spread",$post,array("id"=>$post['id']));            }else{                $res = $this->db->insert("spread",$post);            }			if ($res!==false) {				$this->tip("操作成功", array('inIframe' => true));				$this->exeJs("parent.com.xhide();parent.main.refresh()");			} else {				$this->tip("操作失败", array('inIframe' => true, 'type' => 1));			}			exit;		}		$id = (int) $_GET['id'];		$row = $this->db->get("SELECT * FROM ###_spread WHERE id=" . $id);        $row['thumb'] = isset($row['thumb']) ? $row['thumb'] : '';        $row['html_thumb'] = $this->form->files('thumb', $row['thumb'], '上传图集', array(),array("appurl"=>1));        $this->smarty->assign('row', $row);        $data['list'] = array();		if($row['gid']){            $this->load->model("order");            $this->load->model("goods");            $this->load->model("goodscat");            $actTypes = $this->order->actTypes;		    $goods_list = $this->db->select("select * from ###_goods where id in ({$row['gid']})");		    foreach($goods_list as $k=>$v){                $v = $this->goods->getThumb($v);                $v['cat_name_str'] = $this->goodscat->get_catnamestr($v['cid']);                $v['type_name'] = $actTypes[$v['typeid']]['title'];                $data['list'][$k] = $v;            }        }        $this->smarty->assign('data', $data);		$this->smarty->assign('typeid', $this->typeid);		$this->smarty->display('manage/spread/edit.html');	}	}