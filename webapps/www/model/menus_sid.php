<?php/** * Class menus_sid_model */class menus_sid_model extends Lowxp_Model {	function __construct() {}	/** 后台菜单 权限节点控制	 * @param bool $node false只返回权限节点菜单 true链接权限控制	 * @return array	 */	function menus_node($node = true) {		$x = Lowxp_Router::getInstance()->segments;		unset($x[0]);		$url = implode('/', $x);		if (BGID != 0) {			$group = $this->db->get("SELECT * FROM ###_business_user_group WHERE id=" . BGID);			if (!isset($group['id']) || empty($group['menu_list'])) {				die('该用户无权限!');			}			$group_menus = explode(',',$group['menu_list']);		}        $menus_array = $this->menus_array("menus");		if($group_menus){		    foreach($menus_array as $k=>$v){		        foreach($v as $_k=>$_v){                    if(!in_array($_k,$group_menus)){                        $menus_diff[] = trim($_v['mod']) . (trim($_v['action']) ? ('/' . trim($_v['action'])) : '') . (trim($_v['param']) ? ('/' . trim($_v['param'])) : '');                        unset($menus_array[$k][$_k]);                    }                }            }        }        $res_gid = $menus_array;        #权限判断        if (!empty($menus_diff) && $node && $url) {            foreach ($menus_diff as $s) {                if ($s == $url) {                    return array('code' => 1001, 'msg' => '无权限访问');                }            }            return true;        }		return $res_gid;	}	function menus_array($type = "all"){        $menus = array(            0 => array(                1 => array('id' => '1', 'name' => '控制台', 'parentid' => '0', 'mod' => 'setting', 'action' => 'index'),                97 => array('id' => '97', 'name' => '商城', 'parentid' => '0', 'mod' => 'mall', 'action' => 'index'),                209 => array('id' => '209', 'name' => '订单', 'parentid' => '0', 'mod' => 'order', 'action' => 'index'),                183 => array('id' => '183', 'name' => '营销', 'parentid' => '0', 'mod' => 'marketing', 'action' => 'index'),                1001 => array('id' => '1001', 'name' => '结算', 'parentid' => '0', 'mod' => 'business', 'action' => 'bill_log'),                1501 => array('id' => '1501', 'name' => '客服', 'parentid' => '0', 'mod' => 'chat', 'action' => 'index'),                2001 => array('id' => '2001', 'name' => '设置', 'parentid' => '0', 'mod' => 'business', 'action' => 'setting'),            ),            1 => array(                133 => array('id' => '133', 'name' => '控制台', 'parentid' => '1', 'mod' => 'timing', 'action' => 'index'),                134 => array('id' => '134', 'name' => '日志管理', 'parentid' => '1', 'mod' => 'logs', 'action' => 'index'),            ),            97 => array(                98 => array('id' => '98', 'name' => '商品管理', 'parentid' => '97', 'mod' => 'goods', 'action' => 'index'),                138 => array('id' => '138', 'name' => '评价管理', 'parentid' => '97', 'mod' => 'rate', 'action' => 'index'),                //81 =>array( 'id' => '81', 'name' => '图片相册', 'parentid' => '97', 'mod' => 'upload', 'action' => 'media'),                222 => array('id' => '222', 'name' => '自提地址', 'parentid' => '97', 'mod' => 'take_address', 'action' => 'index'),            ),            209 => array(                106 => array('id' => '106', 'name' => '订单管理', 'parentid' => '209', 'mod' => 'order', 'action' => 'index'),                202 => array('id' => '202', 'name' => '拼团订单', 'parentid' => '209', 'mod' => 'team', 'action' => 'index'),                205 => array('id' => '205', 'name' => '退款列表', 'parentid' => '209', 'mod' => 'refund', 'action' => 'lists/1'),                206 => array('id' => '206', 'name' => '退货列表', 'parentid' => '209', 'mod' => 'refund', 'action' => 'lists/2'),            ),            183 => array(                186 => array('id' => '186', 'name' => '优惠券管理', 'parentid' => '183', 'mod' => 'coupon', 'action' => 'index'),                3001 => array('id' => '3001', 'name' => '竞价活动', 'parentid' => '183', 'mod' => 'topic', 'action' => 'index/1/1'),                3002 => array('id' => '3002', 'name' => '专题活动', 'parentid' => '183', 'mod' => 'topic', 'action' => 'index/2/6'),                3003 => array('id' => '3003', 'name' => '我的报名', 'parentid' => '183', 'mod' => 'topic', 'action' => 'apply_list'),                3004 => array('id' => '3004', 'name' => '砍价管理', 'parentid' => '183', 'mod' => 'bargain', 'action' => 'index'),                3005 => array('id' => '3005', 'name' => '助力管理', 'parentid' => '183', 'mod' => 'assist', 'action' => 'index'),            ),            1001 => array(                1002 => array('id' => '1002', 'name' => '开户行设置', 'parentid' => '1001', 'mod' => 'business', 'action' => 'bankcard'),                //1003 => array('id' => '1003', 'name' => '订单结算', 'parentid' => '1001', 'mod' => 'business', 'action' => 'bill'),                1004 => array('id' => '1004', 'name' => '结算明细', 'parentid' => '1001', 'mod' => 'business', 'action' => 'bill_log'),                1005 => array('id' => '1005', 'name' => '提现管理', 'parentid' => '1001', 'mod' => 'business', 'action' => 'withdrawals_log'),                1006 => array('id' => '1006', 'name' => '保证金管理', 'parentid' => '1001', 'mod' => 'business', 'action' => 'account'),            ),            1501 => array(                1052 => array('id' => '1052', 'name' => '接待窗口', 'parentid' => '1501', 'mod' => 'chat', 'action' => 'index'),                1053 => array('id' => '1053', 'name' => '手机接待', 'parentid' => '1501', 'mod' => 'chat', 'action' => 'mobile'),                1054 => array('id' => '1054', 'name' => '客服设置', 'parentid' => '1501', 'mod' => 'chat', 'action' => 'setting'),                1055 => array('id' => '1055', 'name' => '聊天记录', 'parentid' => '1501', 'mod' => 'chat', 'action' => 'records'),                1056 => array('id' => '1056', 'name' => '自动回复', 'parentid' => '1501', 'mod' => 'chat', 'action' => 'autoreplay'),            ),            2001 => array(                2002 => array('id' => '2002', 'name' => '店铺设置', 'parentid' => '2001', 'mod' => 'business', 'action' => 'setting'),                //2003 =>array( 'id' => '2003', 'name' => '轮播广告', 'parentid' => '2001', 'mod' => 'business', 'action' => 'ad'),                2004 => array('id' => '2004', 'name' => '密码修改', 'parentid' => '2001', 'mod' => 'business', 'action' => 'updatepwd'),                2005 => array('id' => '2005', 'name' => '快递公司', 'parentid' => '2001', 'mod' => 'express', 'action' => 'index'),                2006 => array('id' => '2006', 'name' => '图片分类', 'parentid' => '2001', 'mod' => 'gallery_tag', 'action' => 'index'),                2007 => array('id' => '2007', 'name' => '管理员列表', 'parentid' => '2001', 'mod' => 'admin', 'action' => 'index'),                2008 => array('id' => '2008', 'name' => '管理员角色', 'parentid' => '2001', 'mod' => 'admin', 'action' => 'role'),            ),        );        $subMenu = array ();        if($type=="all"){            return array("menus"=>$menus,"subMenu"=>$subMenu);        }elseif($type=="menus"){            return $menus;        }elseif($type=="subMenu"){            return $subMenu;        }    }}