<?php/** * Class fav_model */class fav_model extends Lowxp_Model {	public $baseTable = '###_fav';	#收藏与取消收藏	function save($goods_id, $mid) {		if (!$goods_id || !$mid) {			return array('code' => 0, 'type' => '', 'message' => '参数错误');		}		$is_fav = $this->is_fav($goods_id, $mid);		if ($is_fav) {			$this->db->delete($this->baseTable, array('goods_id' => $goods_id, 'mid' => $mid));			return array('code' => 0, 'type' => 'delete', 'message' => '已取消收藏');		} else {			$this->db->insert($this->baseTable, array(				'goods_id' => $goods_id,				'mid'      => $mid,				'addtime'  => time(),			));			return array('code' => 0, 'type' => 'insert', 'message' => '收藏成功');		}	}	#判断是否收藏	function is_fav($goods_id, $mid) {		if (!$goods_id || !$mid) {			return false;		}		$sql = "SELECT 1 FROM " . $this->baseTable . " WHERE mid='$mid' AND goods_id='$goods_id' ";		$row = $this->db->get($sql);		if ($row) {			return true;		}		return false;	}	/** 我的收藏列表	 * @param int $size	 * @param int $page	 * @param int $mid	 */	function getList($size = 10, $page = 1, $mid = 0) {		$table = $this->baseTable;		$where = ' WHERE 1 ';		$order = ' ORDER BY addtime DESC';		$list  = array();                		#按商品分类ID		if ($mid) {			$where .= " AND mid=" . $mid;		}		#分页		$this->load->model('page');		$_GET['page'] = intval($page);		$this->page->set_vars(array('per' => $size));		#内容列表结果		$sql  = "SELECT * FROM " . $table . $where . $order;		$list = $this->page->hashQuery($sql)->result_array();		$list = $this->db->lJoin($list, 'goods', 'id,name,thumb,team_price,team_num', 'goods_id', 'id', 'goods_');		return $list;	}	/** 删除收藏 * @param int $ids string|array */	function delFav($ids) {		if (is_array($ids)) {			foreach ($ids as $k => $v) {				$this->db->delete($this->baseTable, array('id' => $v));			}		} else {			$sql = "DELETE FROM ###_fav WHERE id in ($ids) ";			$this->db->query($sql);		}		return array('code' => 0, 'type' => 'delete', 'message' => '已取消收藏');	}	/**	 * 取消收藏	 * @param $ids	 * @return array	 */	function favDelete($ids,$mid) {		$sql = "DELETE FROM ###_fav WHERE id in ($ids) AND mid = $mid";		return $this->db->query($sql);	}	#收藏与取消收藏	function favAddOrDelete($goods_id, $mid) {		if (!$goods_id || !$mid) {			return array('code' => 0, 'type' => '', 'message' => '参数错误');		}		$is_fav = $this->is_fav($goods_id, $mid);		if ($is_fav) {			return $this->db->delete($this->baseTable, array('goods_id' => $goods_id, 'mid' => $mid));		} else {			return $this->db->insert($this->baseTable, array(				'goods_id' => $goods_id,				'mid'      => $mid,				'addtime'  => time(),			));		}	}                /** 我收藏的店铺	 * @param int $size	 * @param int $page	 * @param int $mid	 */	function getStoreList($size = 10, $page = 1, $mid = 0) {		$table = $this->baseTable;		$where = ' WHERE 1 ';		$order = ' ORDER BY c_time DESC';		$list  = array();                		#按商品分类ID		if ($mid) {			$where .= " AND mid=" . $mid;		}		#分页		$this->load->model('page');		$_GET['page'] = intval($page);		$this->page->set_vars(array('per' => $size));		#内容列表结果		$sql  = "SELECT * FROM ###_business_fav " . $where . $order;		$list = $this->page->hashQuery($sql)->result_array();		$list = $this->db->lJoin($list, 'business', 'id,name,logo,fav_num', 'sid', 'id', 'store_');		return $list;	}}