<?php/** * Class topic_type_model */class topic_type_model extends Lowxp_Model {	private $baseTable = '###_topic_type';	function __construct() {}	//保存数据	function save() {		$post = $_POST['post'];		$id   = isset($_POST['id']) ? intval($_POST['id']) : 0;		#表单处理		if (empty($post['name'])) {return array('code' => 10001, 'message' => '请输入活动名称!');}		#重复处理		$where = $id ? " and id!=" . $id : '';		$res   = $this->db->select("select * from " . $this->baseTable . " where name='" . $post['name'] . "'" . $where);		if ($res) {return array('code' => 10003, 'message' => '活动名称已经存在，请更换!');}        if (isset($post['thumb']) && !empty($post['thumb'])) {            $_arrData = array();            foreach ($post['thumb']['path'] as $k => $v) {                $_arrData[$k]['path'] = $v;                $_arrData[$k]['title'] = $post['thumb']['title'][$k];            }            $post['thumb'] = json_encode($_arrData);        } else {            $post['thumb'] = '';        }		#保存		$where = $id ? array('id' => $id) : '';		$res   = $this->db->save($this->baseTable, $post, '', $where);		if (empty($res)) {return array('code' => 10002, 'message' => '数据操作失败!');} //未知错误		if ($id) {			admin_log('编辑活动：' . $post['name']);			return array('code' => 0, 'type' => 'update', 'message' => '更新成功');		} else {			admin_log('添加活动：' . $post['name']);			return array('code' => 0, 'type' => 'insert', 'message' => '添加成功');		}	}    //保存数据    function getList($option = array()) {	    $where = "1";	    if($option['where'])$where.=$option['where'];        $sql  = "SELECT * FROM " . $this->baseTable . " WHERE {$where} ORDER BY id";        $list = $this->db->select($sql);        return $list;    }    function getTypeList($typeid=0){	    if($typeid>0){	        $where = " and typeid=".$typeid;        }	    $res = $this->db->select("select id,name from " . $this->baseTable . " where status=1 {$where} ");	    $list = array();	    foreach($res as $k=>$v){            $list[$v['id']] = $v['name'];        }        return $list;    }}