<?php/** * Class gallery_tag_model */class gallery_tag_model extends Lowxp_Model {    private $baseTable = '###_gallery_tag';    function __construct() {}    //保存数据    function save() {        $post = $_POST['post'];        $id   = isset($_POST['id']) ? intval($_POST['id']) : 0;        #表单处理        if (empty($post['name'])) {return array('code' => 10001, 'message' => '请输入多媒体分类名称!');}        #重复处理        $where = $id ? " and id!=" . $id . " AND `type`='" . $post['type'] . "'" : '';        $res   = $this->db->select("select * from " . $this->baseTable . " where name='" . $post['name'] . "' and sid={$post['sid']} " . $where);        if ($res) {return array('code' => 10003, 'message' => '多媒体分类名称已经存在，请更换!');}        #保存        $where = $id ? array('id' => $id) : '';        $res   = $this->db->save($this->baseTable, $post, '', $where);        if (empty($res)) {return array('code' => 10002, 'message' => '数据操作失败!');} //未知错误        if ($id) {            admin_log('编辑多媒体分类名称：' . $post['name']);            return array('code' => 0, 'type' => 'update', 'message' => '更新成功');        } else {            admin_log('添加多媒体分类名称：' . $post['name']);            return array('code' => 0, 'type' => 'insert', 'message' => '添加成功');        }    }    /** 获取栏目下拉     * @param string $value 当前选中     * @param string $moduleid 只显示此模型下的栏目     * @param bool $showparent 是否显示父级（用于检索时true,添加内容时false)     * @return mixed     */    function category_option($value = '', $moduleid = '', $showparent = false, $parent_id = 0,$pwhere=' and sid=0 ') {        $this->load->library('tree');        $category = $this->select($parent_id,$pwhere);        $array    = array();        foreach ($category as $r) {            $r['selected'] = $r['id'] == $value ? 'selected' : '';            $r['disabled'] = '';            if ($moduleid) {                $arr  = $this->base->explodeChar($r['arrchildid'], ",");                $show = 0;                foreach ((array) $arr as $rr) {                    $show = 1;                }                if (empty($show)) {                    continue;                }                $r['disabled'] = ($r['child'] && $showparent == false) ? ' disabled' : '';            }            $array[] = $r;        }        $str = "<option value='\$id' \$disabled \$selected>\$spacer\$name</option>";        $this->tree->set_params($array);        $select_categorys = $this->tree->get_tree(0, $str, $value);        return $select_categorys;    }    //获取栏目    function select($id = '',$pwhere=' and sid=0 ') {        $where = ' WHERE id<>0 and type="image" '.$pwhere;        if ($id) {            $where .= " AND parentid='$id' ";        }        $array = $this->db->select("SELECT * FROM " . $this->baseTable . $where . " ORDER BY id ASC");        $list = array();        foreach ($array as $v) {            $list[$v['id']] = $v;        }        return $list;    }}