<?php/** * Class msg_model */class msg_model extends Lowxp_Model {	private $baseTable = '###_msg';	function __construct() {}	function save() {		$post = $_POST['post'];		#表单处理		if (empty($post['title'])) {return array('code' => 10001, 'message' => '请输入公告标题!');}		if (empty($post['content'])) {return array('code' => 10001, 'message' => '请输入公告内容!');}		#初始值		$post['add_time'] = time();		if (!$post['tomid']) {			if ($post['tomid_type'] == 1) {				$post['tousername'] = '管理员';			} else {				$post['tousername'] = '所有会员';			}		}		#保存		$where = $post['id'] ? array('id' => (int) $post['id']) : '';		if (empty($post['id'])) {			unset($post['id']);		}		$res = $this->db->save($this->baseTable, $post, '', $where);		if (empty($res)) {return array('code' => 10002, 'message' => '数据操作失败!');} //未知错误		if ($post['id']) {			admin_log('编辑会员公告：' . $post['title']);			return array('code' => 0, 'type' => 'update', 'message' => '更新成功');		} else {			admin_log('添加会员公告：' . $post['title']);			return array('code' => 0, 'type' => 'insert', 'message' => '添加成功');		}	}	//标记已读	function markRead($msg_id, $mid) {		$row         = $this->db->get("SELECT * FROM ###_member_msg WHERE mid='" . $mid . "'");		$where       = array();		$post['mid'] = $mid;		if ($row) {			$post['msg_ids'] = $row['msg_ids'] . ',' . $msg_id;			$where['mid']    = $mid;		} else {			$post['msg_ids'] = $msg_id;		}		$res = $this->db->save('member_msg', $post, '', $where);	}}